<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="storeLog">


    <sql id="sql_where">
        <if test="null!=warehousname  and ''!= warehousname">
            and w.name LIKE concat('%',#{warehousname},'%')
        </if>
        <if test="null!=check_name  and ''!= check_name">
            and a.check_name LIKE concat('%',#{check_name},'%')
        </if>
        <if test="null!=check_number  and ''!= check_number">
            and a.check_number LIKE concat('%',#{check_number},'%')
        </if>
        <if test="null!=check_status  and ''!= check_status">
            and a.check_status = #{check_status}
        </if>
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
    </sql>

    <!-- 查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT a.*,w.`name` as warehousname,s.username as operatorname,
        s1.val as statusval
        FROM w_store_log a
        LEFT JOIN w_warehouse w ON a.warehous_id = w.id
        LEFT JOIN sys_user s ON a.operator = s.id
        LEFT JOIN sys_config s1 ON a.check_status = s1.id
        WHERE a.is_delete = 'N'
        <include refid="sql_where"/>
        ORDER BY a.id
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        select count(1) as total
        FROM w_store_log a
        LEFT JOIN w_warehouse w ON a.warehous_id = w.id
        LEFT JOIN sys_user s ON a.operator = s.id
        LEFT JOIN sys_config s1 ON a.check_status = s1.id
        WHERE a.is_delete = 'N'
        <include refid="sql_where"/>
    </select>

    <!-- 查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT a.*,w.`name` as warehousname,s.username as operatorname,
        s1.val as statusval
        FROM w_store_log a
        LEFT JOIN w_warehouse w ON a.warehous_id = w.id
        LEFT JOIN sys_user s ON a.operator = s.id
        LEFT JOIN sys_config s1 ON a.check_status = s1.id
        WHERE a.is_delete = 'N'
        <include refid="sql_where"/>
        limit 0,1
    </select>


    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        insert into w_store_log (check_name, check_number,
        warehous_id, operator, check_status,
        remark, create_time, creator,is_delete)
        values (#{check_name}, #{check_number},
        #{warehous_id}, #{operator}, #{check_status},
        #{remark}, now(), #{creator},'N')
        <selectKey resultType="java.lang.String" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        update w_store_log
        set
        <if test="null!=check_name  and ''!= check_name">
            check_name = #{check_name},
        </if>
        <if test="null!=remark  and ''!= remark">
            check_number = #{check_number},
        </if>
        <if test="null!=warehous_id  and ''!= warehous_id">
            warehous_id = #{warehous_id},
        </if>
        <if test="null!=updator  and ''!= updator">
            operator = #{updator},
        </if>
        <if test="null!=check_status  and ''!= check_status">
            check_status = #{check_status},
        </if>
        <if test="null!=remark  and ''!= remark">
            remark = #{remark},
        </if>
        <if test="null!=updator  and ''!= updator">
            updator = #{updator},
        </if>
        update_time = now()
        where id = #{id}
    </update>

    <!-- 删除 -->
    <delete id="deleteInfo" parameterType="map">
        UPDATE w_store_log set is_delete = 'Y' WHERE id = #{id}
    </delete>

</mapper>
