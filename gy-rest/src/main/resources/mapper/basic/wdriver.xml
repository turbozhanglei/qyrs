<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="wdriver">


    <sql id="sql_where">
        <if test="null!=driver_name  and ''!= driver_name">
            and a.drivername like Concat ('%',#{driver_name},'%')
        </if>
        <if test="null!=phone  and ''!= phone">
            and a.mobile like Concat ('%',#{phone},'%')
        </if>
        <if test="null!=car_type  and ''!= car_type">
            and a.driver_type like Concat ('%',#{car_type},'%')
        </if>
        <if test="null!=car_num  and ''!= car_num">
            and a.driver_number like Concat ('%',#{car_num},'%')
        </if>
        <if test="null!=remark  and ''!= remark">
            and a.remark like Concat ('%',#{remark},'%')
        </if>
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
    </sql>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        INSERT INTO w_driverinfo (

        <if test="null!=drivername  and ''!= drivername">drivername ,</if>
        <if test="null!=mobile  and ''!= mobile">mobile ,</if>
        <if test="null!=driver_type  and ''!= driver_type">driver_type ,</if>
        <if test="null!=driver_number  and ''!= driver_number">driver_number ,</if>
        <if test="null!=remark  and ''!= remark">remark ,</if>
        <if test="null!=status">status ,</if>
        create_time,
        update_time
        )
        VALUES
        (

        <if test="null!=drivername  and ''!= drivername">#{drivername} ,</if>
        <if test="null!=mobile  and ''!= mobile">#{mobile} ,</if>
        <if test="null!=driver_type  and ''!= driver_type">#{driver_type} ,</if>
        <if test="null!=driver_number  and ''!= driver_number">#{driver_number} ,</if>
        <if test="null!=remark  and ''!= remark">#{remark} ,</if>
        <if test="null!=status">#{status} ,</if>
        now(),
        now()
        )
        <selectKey resultType="java.lang.Long" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <!-- 删除 -->
    <update id="deleteInfo" parameterType="dto">
        update w_driverinfo a
        set a.is_delete = 'Y'
        where a.id=#{id}
    </update>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        update w_driverinfo
        SET
        <if test="null!=drivername  and ''!= drivername">drivername = #{drivername} ,</if>
        <if test="null!=mobile  and ''!= mobile">mobile= #{mobile} ,</if>
        <if test="null!=driver_type  and ''!= driver_type">driver_type = #{driver_type} ,</if>
        <if test="null!=driver_number  and ''!= driver_number">driver_number = #{driver_number} ,</if>
        <if test="null!=remark  and ''!= remark">remark = #{remark} ,</if>
        <if test="null!=status">status = #{status} ,</if>
        <if test="null!=updator  and ''!= updator">updator = #{updator} ,</if>
        update_time = now()
        where id=#{id}
    </update>

    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT a.*,b.val as type_val
        FROM
        w_driverinfo a
        left join sys_config as b on(a.driver_type=b.id)
        WHERE 1 = 1 AND a.is_delete = 'N'
        <include refid="sql_where"/>
        order by a.id DESC
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 对象查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT a.*,b.val as driver_type_val
        FROM w_driverinfo a
        left join sys_config as b on(a.driver_type=b.id)
        WHERE 1 = 1 AND a.is_delete = 'N'
        <if test="null!=id  and ''!= id">and a.id = #{id}</if>
        <if test="null!=driver_number  and ''!= driver_number">and a.driver_number = #{driver_number}</if>
        limit 0,1
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        select
        count(1) as total
        FROM w_driverinfo a
        WHERE 1 = 1 AND a.is_delete = 'N'
    </select>

    <select id="queryOrderBuySkuDriver" parameterType="map" resultType="dto">
        SELECT
        a.*
        FROM
        w_driverinfo a
        LEFT JOIN w_order_buy_sku_driver b ON a.id = b.driver_id
        WHERE
        1 = 1
        AND a.is_delete = 'N'
        AND b.buy_sku_id = #{buy_sku_id}
    </select>


</mapper>
