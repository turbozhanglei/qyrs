<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->

<!-- 参数管理手工映射SQL语句 -->
<!-- 预期到货通知表 -->
<mapper namespace="wmail">

    <sql id="sql_where">
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
        <if test="null!=in_batch_number  and ''!= in_batch_number">
            and a.in_batch_number = #{in_batch_number}
        </if>
        <if test="null!=status">
            and a.status = #{status}
        </if>
    </sql>

    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        select * from w_mail a
        order by a.id
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        SELECT
        sum(total) as total
        from w_mail a
        <include refid="sql_where"/>
    </select>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="map">
        INSERT INTO `w_mail` ( `in_batch_number`, `to_mail`, `in_mail`, `subject`, `content`, `status`, `result`,
        `create_time`, `creator`, `is_delete`)
        VALUES
        ( #{in_batch_number}, #{to_mail}, #{in_mail}, #{subject}, #{content}, #{status}, #{result}, NOW(), #{creator},
        "N")
        <selectKey resultType="java.lang.String" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>
    </insert>


    <!-- 修改 -->
    <update id="updateInfo" parameterType="map">
        UPDATE `w_mail` SET
        <if test="null!=in_batch_number  and ''!= in_batch_number">in_batch_number=#{in_batch_number} ,</if>
        <if test="null!=to_mail  and ''!= to_mail">to_mail=#{to_mail} ,</if>
        <if test="null!=in_mail  and ''!= in_mail">in_mail=#{in_mail} ,</if>
        <if test="null!=subject  and ''!= subject">subject=#{subject} ,</if>
        <if test="null!=content  and ''!= content">content=#{content} ,</if>
        <if test="null!=status">status=#{status} ,</if>
        <if test="null!=result  and ''!= result">result=#{result} ,</if>
        <if test="null!=create_time  and ''!= create_time">create_time=#{create_time} ,</if>
        <if test="null!=creator  and ''!= creator">creator=#{creator} ,</if>
        <if test="null!=is_delete  and ''!= is_delete">is_delete=#{is_delete} ,</if>
        create_time = NOW()
        where
        a.id = #{id}
    </update>


</mapper>
