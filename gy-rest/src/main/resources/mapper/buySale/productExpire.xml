<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->

<!-- 参数管理手工映射SQL语句 -->
<!-- ASN表商品关联表 -->
<mapper namespace="productExpire">

    <sql id="sql_where">
        where
        a.is_delete = 'N'
        <if test="null!=_id  and ''!= _id">
            and a.id = #{_id}
        </if>

    </sql>


    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">

        SELECT
        a.*, DATE_FORMAT(a.period_time, '%Y-%m-%d') AS period_time,b.order_no
        FROM
        w_order_asn_sku a
        LEFT JOIN w_order_asn b on a.order_id=b.id
        WHERE
        a.period_time = DATE_FORMAT(NOW(), '%Y-%m-%d')
        AND a.is_delete = 'N'
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">

        SELECT count(1) as total
        FROM
        w_order_asn_sku a
        LEFT JOIN w_order_asn b on a.order_id=b.id
        WHERE a.period_time=DATE_FORMAT(NOW(),'%Y-%m-%d')
        and a.is_delete = 'N'
        <if test="null!=order_id  and ''!= order_id">
            and a.order_id = #{order_id}
        </if>
    </select>

    <!-- 对象查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        a.*
        FROM
        w_order_asn_sku a
        <include refid="sql_where"/>
    </select>


</mapper>
