<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="warehouseDevice">


    <sql id="sql_where">

        <if test="null!=code  and ''!= code">
            and a.number LIKE concat('%',#{code},'%')
        </if>
        <if test="null!=names  and ''!= names">
            and a.name LIKE concat('%',#{names},'%')
        </if>
        <if test="null!=modals  and ''!= modals">
            and a.modal LIKE concat('%',#{modals},'%')
        </if>
        <if test="null!=load_weight  and ''!= load_weight">
            and a.maxWeight LIKE concat('%',#{load_weight},'%')
        </if>
        <if test="null!=width_requirement  and ''!= width_requirement">
            and a.widthDemand LIKE concat('%',#{width_requirement},'%')
        </if>
        <if test="null!=storage_warehouse  and ''!= storage_warehouse">
            and a.warehouse_id LIKE concat('%',#{storage_warehouse},'%')
        </if>
        <if test="null!=storage_area  and ''!= storage_area">
            and a.saveArea LIKE concat('%',#{storage_area},'%')
        </if>
        <if test="null!=manager  and ''!= manager">
            and a.manager LIKE concat('%',#{manager},'%')
        </if>
        <if test="null!=dept  and ''!= dept">
            and a.dept_id LIKE concat('%',#{dept},'%')
        </if>
        <if test="null!=phone  and ''!= phone">
            and a.manager_mobile LIKE concat('%',#{phone},'%')
        </if>
        <if test="null!=equipment_nature  and ''!= equipment_nature">
            and a.status = #{equipment_nature}
        </if>
        <if test="null!=remark  and ''!= remark">
            and a.remark LIKE concat('%',#{remark},'%')
        </if>
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
        <if test="null!=area  and ''!= area">
            and a.area  LIKE concat('%',#{area},'%')
        </if>

    </sql>

    <!-- 查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        a.*
        FROM
        w_warehouse_device a
        WHERE
        1 = 1
        AND a.is_delete = 'N'
        <include refid="sql_where"/>
        ORDER BY id
        <if test="null!=start">
            limit ${start},${end}
        </if>
    </select>


    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        select
        count(1) as total
        FROM w_warehouse_device a
        WHERE 1 = 1 AND a.is_delete = 'N'
        <include refid="sql_where"/>
    </select>


    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        insert into w_warehouse_device (

        <if test="null!=number  and ''!= number">number ,</if>
        <if test="null!=name  and ''!= name">name ,</if>
        <if test="null!=modal  and ''!= modal">modal ,</if>
        <if test="null!=maxweight  and ''!= maxweight">maxweight ,</if>
        <if test="null!=widthdemand  and ''!= widthdemand">widthdemand ,</if>
        <if test="null!=warehouse_id  and ''!= warehouse_id">warehouse_id ,</if>
        <if test="null!=savearea  and ''!= savearea">savearea ,</if>
        <if test="null!=devicephoto  and ''!= devicephoto">devicephoto ,</if>
        <if test="null!=dept_id  and ''!= dept_id">dept_id ,</if>
        <if test="null!=manager  and ''!= manager">manager ,</if>
        <if test="null!=manager_mobile  and ''!= manager_mobile">manager_mobile ,</if>
        <if test="null!=status">status ,</if>
        <if test="null!=device_type  and ''!= device_type">device_type ,</if>
        <if test="null!=remark  and ''!= remark">remark ,</if>
        <if test="null!=area  and ''!= area">area ,</if>
        create_time,
        update_time
        )
        VALUES
        (

        <if test="null!=number  and ''!= number">#{number} ,</if>
        <if test="null!=name  and ''!= name">#{name} ,</if>
        <if test="null!=modal  and ''!= modal">#{modal} ,</if>
        <if test="null!=maxweight  and ''!= maxweight">#{maxweight} ,</if>
        <if test="null!=widthdemand  and ''!= widthdemand">#{widthdemand} ,</if>
        <if test="null!=warehouse_id  and ''!= warehouse_id">#{warehouse_id} ,</if>
        <if test="null!=savearea  and ''!= savearea">#{savearea} ,</if>
        <if test="null!=devicephoto  and ''!= devicephoto">#{devicephoto} ,</if>
        <if test="null!=dept_id  and ''!= dept_id">#{dept_id} ,</if>
        <if test="null!=manager  and ''!= manager">#{manager} ,</if>
        <if test="null!=manager_mobile  and ''!= manager_mobile">#{manager_mobile} ,</if>
        <if test="null!=status">#{status} ,</if>
        <if test="null!=device_type  and ''!= device_type">#{device_type} ,</if>
        <if test="null!=remark  and ''!= remark">#{remark} ,</if>
        <if test="null!=area  and ''!= area">#{area} ,</if>
        now(),
        now()
        );
    </insert>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        update w_warehouse_device
        set
        <if test="null!=number  and ''!= number">
            number = #{number},
        </if>
        <if test="null!=name  and ''!= name">
            name = #{name},
        </if>
        <if test="null!=modal  and ''!= modal">
            modal = #{modal},
        </if>
        <if test="null!=maxweight  and ''!= maxweight">
            maxweight = #{maxweight},
        </if>
        <if test="null!=widthdemand  and ''!= widthdemand">
            widthdemand = #{widthdemand},
        </if>
        <if test="null!=warehouse_id  and ''!= warehouse_id">
            warehouse_id = #{warehouse_id},
        </if>
        <if test="null!=savearea  and ''!= savearea">
            savearea = #{savearea},
        </if>
        <if test="null!=devicephoto  and ''!= devicephoto">
            devicephoto = #{devicephoto},
        </if>
        <if test="null!=dept_id  and ''!= dept_id">
            dept_id = #{dept_id},
        </if>
        <if test="null!=manager  and ''!= manager">
            manager = #{manager},
        </if>
        <if test="null!=manager_mobile  and ''!= manager_mobile">
            manager_mobile = #{manager_mobile},
        </if>
        <if test="null!=status">
            status = #{status},
        </if>
        <if test="null!=device_type  and ''!= device_type">
            device_type = #{device_type},
        </if>
        <if test="null!=remark  and ''!= remark">
            remark = #{remark},
        </if>
        <if test="null!=area  and ''!= area">
            area = #{area},
        </if>
        <if test="null!=updator  and ''!= updator">
            updator = #{updator},
        </if>
        update_time = now()
        where id = #{id}
    </update>

    <!-- 删除 -->
    <delete id="deleteInfo" parameterType="map">
        UPDATE w_warehouse_device set is_delete = 'Y' WHERE id = #{id}
    </delete>


    <select id="selectExitWarehouse" parameterType="map" resultType="dto">
        SELECT
        a.railway_platform as name
        FROM
        (
        SELECT
        area AS railway_platform
        FROM
        w_warehouse_device a
        WHERE
        a.is_delete = 'N'
        GROUP BY
        a.area
        UNION
        SELECT
        railway_platform
        FROM
        w_tray a
        WHERE
        a.is_delete = 'N'
        GROUP BY
        a.railway_platform
        ) a
        WHERE a.railway_platform is not NULL
        GROUP BY a.railway_platform
    </select>


    <select id="selectExitWarehouseArea" parameterType="map" resultType="dto">
        SELECT
        a.savearea,
        c.`name`,
        c.number as area_number
        FROM
        (
        SELECT
        a.warehouse_id,
        a.savearea
        FROM
        w_warehouse_device a
        WHERE
        a.is_delete = 'N'
        GROUP BY
        a.warehouse_id,
        a.savearea
        UNION
        SELECT
        a.warehouse_id,
        a.savearea
        FROM
        w_tray a
        WHERE
        a.is_delete = 'N'
        GROUP BY
        a.warehouse_id,
        a.savearea
        ) a
        LEFT JOIN w_warehouse b ON a.warehouse_id = b.id
        LEFT JOIN w_warehouse_area c ON a.savearea = c.id
        WHERE 1 = 1
        <if test="null!=warehouse_id  and ''!= warehouse_id">
            and a.warehouse_id = #{warehouse_id}
        </if>
        GROUP BY
        a.savearea
    </select>


    <select id="selectDeviceCount" parameterType="map" resultType="dto">
        SELECT
        b.val,COUNT(a.id) as total,a.device_type
        FROM
        w_warehouse_device a
        LEFT JOIN sys_config b on a.device_type = b.key and b.type = 'facility_type'
        WHERE
        a.is_delete = 'N'
        <if test="null!=query  and ''!= query">
            and a.area = #{query}
        </if>
        GROUP BY a.device_type
    </select>


    <select id="selectDeviceList" parameterType="map" resultType="dto">
        SELECT
        b.val,a.*,a.area as railway_platform
        FROM
        w_warehouse_device a
        LEFT JOIN sys_config b on a.device_type = b.key and b.type = 'facility_type'
        WHERE
        a.is_delete = 'N'
        <if test="null!=area  and ''!= area">
            and a.area = #{area}
        </if>
        <if test="null!=device_number  and ''!= device_number">
            and a.number LIKE concat('%',#{device_number},'%')
        </if>
    </select>

    <select id="selectTrayCount" parameterType="map" resultType="dto">
        SELECT
        COUNT(a.id) as total
        FROM
        w_tray a
        WHERE
        a.is_delete = 'N'
        <if test="null!=query  and ''!= query">
            and a.railway_platform = #{query}
        </if>
    </select>

    <select id="selectTrayList" parameterType="map" resultType="dto">
        SELECT
        a.*
        FROM
        w_tray a
        WHERE
        a.is_delete = 'N'
        <if test="null!=railway_platform  and ''!= railway_platform">
            and a.railway_platform = #{railway_platform}
        </if>
        <if test="null!=device_number  and ''!= device_number">
            and a.number LIKE concat('%',#{device_number},'%')
        </if>
    </select>
</mapper>
