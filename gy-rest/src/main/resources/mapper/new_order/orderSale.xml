<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="norderSale">


    <sql id="sql_where">
        <if test="null!=order_status   and ''!= order_status ">
            and a.status = #{order_status}
        </if>
        <if test="null!=number  and ''!= number">
            and a.number = #{number}
        </if>
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
        <if test="null!=customer_id  and ''!= customer_id">
            and a.customer_id = #{customer_id}
        </if>
        <if test="null!=order_no  and ''!= order_no">
            and a.order_no LIKE concat('%',#{order_no},'%')
        </if>
        <if test="null!=client_name  and ''!= client_name">
            and b.client_name LIKE concat('%',#{client_name},'%')
        </if>
        <if test="null!=customer_make  and ''!= customer_make">
            and a.customer_make LIKE concat('%',#{customer_make},'%')
        </if>
        <if test="null!=customer_no  and ''!= customer_no">
            and a.customer_no LIKE concat('%',#{customer_no},'%')
        </if>
        <if test="null!=recipient_store  and ''!= recipient_store">
            and a.recipient_store LIKE concat('%',#{recipient_store},'%')
        </if>
        <if test="null!=recipient_store_address  and ''!= recipient_store_address">
            and a.recipient_store_address LIKE concat('%',#{recipient_store_address},'%')
        </if>
        <if test="null!=recipient_people  and ''!= recipient_people">
            and a.recipient_people LIKE concat('%',#{recipient_people},'%')
        </if>
        <if test="null!=recipient_people_mobile  and ''!= recipient_people_mobile">
            and a.recipient_people_mobile LIKE concat('%',#{recipient_people_mobile},'%')
        </if>
        <if test="null!=driver_number  and ''!= driver_number">
            and a.driver_number LIKE concat('%',#{driver_number},'%')
        </if>
        <if test="null!=recipient_people_mobile  and ''!= recipient_people_mobile">
            and a.recipient_people_mobile LIKE concat('%',#{recipient_people_mobile},'%')
        </if>
        <if test="null!=recipient_people_mobile  and ''!= recipient_people_mobile">
            and a.recipient_people_mobile LIKE concat('%',#{recipient_people_mobile},'%')
        </if>
        <if test="null!=storage_time_end  and ''!= storage_time_end">
            and a.storage_time &lt;= #{storage_time_end}
        </if>
        <if test="null!=storage_time_start  and ''!= storage_time_start">
            and a.storage_time >= #{storage_time_start}
        </if>
        <if test="null!=out_stock_end  and ''!= out_stock_end">
            and a.out_stock &lt;= #{out_stock_end}
        </if>
        <if test="null!=out_stock_start  and ''!= out_stock_start">
            and a.out_stock >= #{out_stock_start}
        </if>
        <if test="null!=create_time_end  and ''!= create_time_end">
            and a.create_time &lt;= #{create_time_end}
        </if>
        <if test="null!=create_time_start  and ''!= create_time_start">
            and a.create_time >= #{create_time_start}
        </if>
        <if test="null!=creator_name  and ''!= creator_name">
            and u.username LIKE concat('%',#{creator_name},'%')
        </if>
    </sql>

    <!-- 查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        *, b.legalname AS username,
        c. NAME,
        f.val AS order_status,
        u.username as creator_name,b.client_name
        FROM
        w_order_sale AS a
        LEFT JOIN w_customer AS b ON (a.customer_id = b.id)
        LEFT JOIN w_warehouse_site_setting AS c ON (a.cargo_id = c.id)
        LEFT JOIN sys_config AS f ON (f.id = a.`status`)
        LEFT JOIN sys_user AS u ON (u.id = a.creator)
        where a.is_delete='N' and a.status=48
        <include refid="sql_where"/>
        ORDER BY a.id desc
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 查询 -->
    <select id="queryMobileList" parameterType="map" resultType="dto">
        SELECT
        *, b.legalname AS username,
        c. NAME,
        f.val AS order_status,
        u.username as creator_name,b.client_name
        FROM
        w_order_sale AS a
        LEFT JOIN w_customer AS b ON (a.customer_id = b.id)
        LEFT JOIN w_warehouse_site_setting AS c ON (a.cargo_id = c.id)
        LEFT JOIN sys_config AS f ON (f.id = a.`status`)
        LEFT JOIN sys_user AS u ON (u.id = a.creator)
        where a.is_delete='N' and a.status=48
        <include refid="sql_where"/>
        GROUP BY a.id
        ORDER BY a.id desc
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        select
        count(1) as total
        FROM
        w_order_sale AS a
        LEFT JOIN w_customer AS b ON (a.customer_id = b.id)
        LEFT JOIN w_warehouse_site_setting AS c ON (a.cargo_id = c.id)
        LEFT JOIN sys_config AS f ON (f.id = a.`status`)
        where a.is_delete='N' and a.status=48
        <include refid="sql_where"/>
    </select>

    <!-- 查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        *, b.legalname AS username,
        c. NAME,
        f.val AS order_status,
        g.val as creator_name
        FROM
        w_order_sale AS a
        LEFT JOIN w_customer AS b ON (a.customer_id = b.id)
        LEFT JOIN w_warehouse_site_setting AS c ON (a.cargo_id = c.id)
        LEFT JOIN sys_config AS f ON (f.id = a.`status`)
        LEFT JOIN sys_config AS g ON (g.id = a.creator)
        where a.is_delete='N'
        <include refid="sql_where"/>
        limit 0,1
    </select>


    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        insert into w_order_sale
        (
        <if test="null!=order_no  and ''!= order_no">
            order_no,
        </if>
        <if test="null!=cargo_id  and ''!= cargo_id">
            cargo_id ,
        </if>
        <if test="null!=customer_id  and ''!= customer_id">
            customer_id ,
        </if>
        <if test="null!=customer_no  and ''!= customer_no">
            customer_no ,
        </if>
        <if test="null!=order_photo  and ''!= order_photo">
            order_photo ,
        </if>
        <if test="null!=order_licence  and ''!= order_licence">
            order_licence ,
        </if>
        <if test="null!=recipient_store  and ''!= recipient_store">
            recipient_store ,
        </if>
        <if test="null!=recipient_store_address  and ''!= recipient_store_address">
            recipient_store_address ,
        </if>
        <if test="null!=recipient_people  and ''!= recipient_people">
            recipient_people ,
        </if>
        <if test="null!=recipient_people_mobile  and ''!= recipient_people_mobile">
            recipient_people_mobile ,
        </if>
        <if test="null!=storage_time  and ''!= storage_time">
            storage_time ,
        </if>
        <if test="null!=out_stock  and ''!= out_stock">
            out_stock ,
        </if>
        <if test="null!=customer_make  and ''!= customer_make">
            customer_make ,
        </if>
        <if test="null!=remark  and ''!= remark">
            remark ,
        </if>
        <if test="null!=bill_zip  and ''!= bill_zip">
            bill_zip ,
        </if>
        status
        ,create_time
        ,creator
        ,is_delete
        )
        values (
        <if test="null!=order_no  and ''!= order_no">
            #{order_no},
        </if>
        <if test="null!=cargo_id  and ''!= cargo_id">
            #{cargo_id} ,
        </if>
        <if test="null!=customer_id  and ''!= customer_id">
            #{customer_id} ,
        </if>
        <if test="null!=customer_no  and ''!= customer_no">
            #{customer_no} ,
        </if>
        <if test="null!=order_photo  and ''!= order_photo">
            #{order_photo} ,
        </if>
        <if test="null!=order_licence  and ''!= order_licence">
            #{order_licence} ,
        </if>
        <if test="null!=recipient_store  and ''!= recipient_store">
            #{recipient_store} ,
        </if>
        <if test="null!=recipient_store_address  and ''!= recipient_store_address">
            #{recipient_store_address} ,
        </if>
        <if test="null!=recipient_people  and ''!= recipient_people">
            #{recipient_people} ,
        </if>
        <if test="null!=recipient_people_mobile  and ''!= recipient_people_mobile">
            #{recipient_people_mobile} ,
        </if>
        <if test="null!=storage_time  and ''!= storage_time">
            #{storage_time} ,
        </if>
        <if test="null!=out_stock  and ''!= out_stock">
            #{out_stock} ,
        </if>
        <if test="null!=customer_make  and ''!= customer_make">
            #{customer_make} ,
        </if>
        <if test="null!=remark  and ''!= remark">
            #{remark} ,
        </if>
        <if test="null!=bill_zip  and ''!= bill_zip">
            #{bill_zip} ,
        </if>
        48
        ,now()
        ,#{creator}
        ,'N'
        )
        <selectKey resultType="java.lang.String" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        update w_order_sale
        set
        <if test="null!=order_no  and ''!= order_no">
            order_no=#{order_no},
        </if>
        <if test="null!=cargo_id  and ''!= cargo_id">
            cargo_id=#{cargo_id},
        </if>
        <if test="null!=customer_id  and ''!= customer_id">
            customer_id=#{customer_id},
        </if>
        <if test="null!=customer_no  and ''!= customer_no">
            customer_no=#{customer_no},
        </if>
        <if test="null!=order_licence  and ''!= order_licence">
            order_licence=#{order_licence},
        </if>
        <if test="null!=order_photo  and ''!= order_photo">
            order_photo=#{order_photo},
        </if>
        <if test="null!=recipient_store  and ''!= recipient_store">
            recipient_store=#{recipient_store},
        </if>
        <if test="null!=recipient_store_address  and ''!= recipient_store_address">
            recipient_store_address=#{recipient_store_address},
        </if>
        <if test="null!=recipient_people  and ''!= recipient_people">
            recipient_people=#{recipient_people},
        </if>
        <if test="null!=recipient_people_mobile  and ''!= recipient_people_mobile">
            recipient_people_mobile=#{recipient_people_mobile},
        </if>
        <if test="null!=storage_time  and ''!= storage_time">
            storage_time=#{storage_time},
        </if>
        <if test="null!=out_stock  and ''!= out_stock">
            out_stock=#{out_stock},
        </if>
        <if test="null!=customer_make  and ''!= customer_make">
            customer_make=#{customer_make},
        </if>
        <if test="null!=remark  and ''!= remark">
            remark=#{remark},
        </if>
        update_time = now()
        where id = #{id}
    </update>

    <!-- 删除 -->
    <delete id="deleteInfo" parameterType="map">
        UPDATE w_order_sale set is_delete = 'Y' WHERE id = #{id}
    </delete>


</mapper>
