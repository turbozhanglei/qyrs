<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="wmsOrderOutstore">


    <sql id="sql_where">
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
        <if test="null!=outstore_no  and ''!= outstore_no">
            and a.outstore_no LIKE concat('%', #{outstore_no}, '%')
        </if>
        <if test="null!=status">
            and a.status = #{status}
        </if>
        <if test="null!=outstore_type  and ''!= outstore_type">
            and a.outstore_type = #{outstore_type}
        </if>
        <if test="null!=user  and ''!= user">
            and a.user = #{user}
        </if>
        <if test="null!=begin_time  and ''!= begin_time">
            and a.create_time &gt;= #{begin_time}
        </if>
        <if test="null!=end_time  and ''!= end_time">
            and a.create_time &lt;= #{end_time}
        </if>
    </sql>

    <!-- 查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        a.*,p.name AS providerName,w.name AS warehouseName,c1.val AS outstoreType,c2.val AS statusCh
        FROM
        wms_order_outstore a
        LEFT JOIN oms_cmn_provider p ON a.provider_id = p.id
        LEFT JOIN wms_warehouse w ON a.warehouse_id = w.id
        LEFT JOIN sys_config c1 ON a.outstore_type = c1.id
        LEFT JOIN sys_config c2 ON a.status = c2.id
        WHERE
        1 = 1
        AND a.is_delete = 'N'
        <include refid="sql_where"/>
        <if test="null!=providerName  and ''!= providerName">
            and p.name LIKE concat('%', #{providerName}, '%')
        </if>
        <if test="null!=warehouseName  and ''!= warehouseName">
            and w.name LIKE concat('%', #{warehouseName}, '%')
        </if>
        ORDER BY id
    </select>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        insert into wms_order_outstore
        (outstore_no,provider_id,warehouse_id,outstore_type,user,amount,remark,status,create_time,creator,update_time,updator,is_delete)
        values
        (#{outstore_no},#{provider_id},#{warehouse_id},#{outstore_type},#{user},#{amount},#{remark},#{status},now(),#{creator},now(),#{updator},'N')
    </insert>

    <!-- 删除 -->
    <delete id="deleteInfo" parameterType="map">
        UPDATE wms_order_outstore set is_delete = 'Y' WHERE id = #{id}
    </delete>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        update wms_order_outstore
        set
        <if test="null!=outstore_no1  and ''!= outstore_no1">
            outstore_no = #{outstore_no1},
        </if>
        <if test="null!=provider_id1  and ''!= provider_id1">
            provider_id = #{provider_id1},
        </if>
        <if test="null!=warehouse_id1  and ''!= warehouse_id1">
            warehouse_id = #{warehouse_id1},
        </if>
        <if test="null!=outstore_type1  and ''!= outstore_type1">
            outstore_type = #{outstore_type1},
        </if>
        <if test="null!=user1  and ''!= user1">
            user = #{user1},
        </if>
        <if test="null!=amount1  and ''!= amount1">
            amount = #{amount1},
        </if>
        <if test="null!=remark1  and ''!= remark1">
            remark = #{remark1},
        </if>
        <if test="null!=statusch1  and ''!= statusch1">
            status = #{statusch1},
        </if>
        update_time = now(),
        updator = #{updator}
        where id = #{id}
    </update>

    <!-- 查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        a.*,p.name AS providerName,w.name AS warehouseName,c1.val AS outstoreType,c2.val AS statusCh
        FROM
        wms_order_outstore a
        LEFT JOIN oms_cmn_provider p ON a.provider_id = p.id
        LEFT JOIN wms_warehouse w ON a.warehouse_id = w.id
        LEFT JOIN sys_config c1 ON a.outstore_type = c1.id
        LEFT JOIN sys_config c2 ON a.status = c2.id
        WHERE
        1 = 1
        AND a.is_delete = 'N'
        <include refid="sql_where"/>
        limit 0,1
    </select>
</mapper>
