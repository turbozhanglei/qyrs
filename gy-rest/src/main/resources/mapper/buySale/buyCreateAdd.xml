<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="buyCreateAdd">

    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        order_buy.id,
        order_buy.order_no,
        config.val,
        provider.name AS coma,
        provider1.name AS comb,
        order_buy.create_order_time,
        order_buy.start_time,
        order_buy.end_time
        FROM
        oms_order_buy_add order_buy
        LEFT JOIN oms_contract contract ON contract.id = order_buy.contract_id
        LEFT JOIN sys_config config ON config.id = contract.type
        LEFT JOIN oms_cmn_provider provider ON provider.id = order_buy.coma
        LEFT JOIN oms_cmn_provider provider1 ON provider1.id = order_buy.comb
        WHERE
        order_buy.is_delete = 'N'
        <if test="null!=_number  and ''!= _number">
            and order_buy.number = #{_number}
        </if>
        <if test="null!=_type_id  and ''!= _type_id">
            and order_buy.type = #{_type_id}
        </if>
        <if test="null!=_coma  and ''!= _coma">
            and provider.name LIKE CONCAT('%', #{_coma}, '%')
        </if>

        <if test="null!=_begin_time1">
            and order_buy.create_time BETWEEN ''
        </if>
        <if test="null!=_begin_time1  and ''!= _begin_time1">
            and order_buy.create_time BETWEEN #{_begin_time1}
        </if>
        <if test="null!=_end_time1">
            and now()
        </if>
        <if test="null!=_end_time1  and ''!= _end_time1">
            and #{_end_time1}
        </if>

        <if test="null!=_begin_time2">
            and order_buy.start_time BETWEEN ''
        </if>
        <if test="null!=_begin_time2  and ''!= _begin_time2">
            and order_buy.start_time BETWEEN #{_begin_time2}
        </if>
        <if test="null!=_end_time2">
            and now()
        </if>
        <if test="null!=_end_time2  and ''!= _end_time2">
            and #{_end_time2}
        </if>

        <if test="null!=_begin_time3">
            and order_buy.end_time BETWEEN ''
        </if>
        <if test="null!=_begin_time3  and ''!= _begin_time3">
            and order_buy.end_time BETWEEN #{_begin_time3}
        </if>
        <if test="null!=_end_time3">
            and now()
        </if>
        <if test="null!=_end_time3  and ''!= _end_time3">
            and #{_end_time3}
        </if>
        order by order_buy.update_time desc
    </select>

    <!-- 对象查询 (有问题,未验证) -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        contract.id,
        contract.number,
        users.username,
        contract.type,
        provider. NAME AS coma,
        provider1. NAME AS comb,
        contract.create_time,
        contract.begin_time,
        contract.end_time,
        contract.totals
        FROM
        oms_contract contract
        LEFT JOIN sys_user users ON users.id = contract.user_id
        LEFT JOIN oms_cmn_provider provider ON provider.id = contract.coma
        LEFT JOIN oms_cmn_provider provider1 ON provider1.id = contract.comb
        where
        contract.id= #{id}
    </select>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        UPDATE oms_contract
        SET
        <if test="null!=number  and ''!= number">contract.number = #{number} ,</if>
        <if test="null!=type">contract.type = #{type} ,</if>
        <if test="null!=create_time  and ''!= create_time">contract.create_time=#{create_time} ,</if>
        <if test="null!=begin_time  and ''!= begin_time">contract.begin_time = #{begin_time} ,</if>
        <if test="null!=end_time  and ''!= end_time">contract.end_time = #{end_time} ,</if>
        <if test="null!=totals  and ''!= totals">contract.totals = #{totals} ,</if>
        <if test="null!=updator  and ''!= updator">updator = #{updator} ,</if>
        update_time = now()
        where contract.id= #{id}
    </update>
</mapper>
