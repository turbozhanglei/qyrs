<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->

<!-- 参数管理手工映射SQL语句 -->
<!-- 补货表 -->
<mapper namespace="wOrderAdd">

    <sql id="sql_where">
        where
        a.is_delete = 'N'
        <if test="null!=_id  and ''!= _id">
            and a.id = #{_id}
        </if>
        <if test="null!=_order_no  and ''!= _order_no">
            and a.order_no = #{_order_no}
        </if>
        <if test="null!=_contract_id  and ''!= _contract_id">
            and a.contract_id = #{_contract_id}
        </if>
        <if test="null!=_coma  and ''!= _coma">
            and a.coma = #{_coma}
        </if>
        <if test="null!=_comb  and ''!= _comb">
            and a.comb = #{_comb}
        </if>
        <if test="null!=_amount  and ''!= _amount">
            and a.amount = #{_amount}
        </if>
        <if test="null!=_start_time  and ''!= _start_time">
            and a.start_time = #{_start_time}
        </if>
        <if test="null!=_end_time  and ''!= _end_time">
            and a.end_time = #{_end_time}
        </if>
        <if test="null!=_create_order_time  and ''!= _create_order_time">
            and a.create_order_time = #{_create_order_time}
        </if>
        <if test="null!=_create_order_user  and ''!= _create_order_user">
            and a.create_order_user = #{_create_order_user}
        </if>
        <if test="null!=_enter_library_time  and ''!= _enter_library_time">
            and a.enter_library_time = #{_enter_library_time}
        </if>
        <if test="null!=_status  and ''!= _status">
            and a.status = #{_status}
        </if>
        <if test="null!=startDate  and ''!= startDate">
            and a.create_time >= concat(#{startDate},' ','00:00:00')
        </if>
        <if test="null!=endDate  and ''!= endDate">
            and a.create_time &lt;= concat(#{endDate},' ','23:59:59')
        </if>
        <if test="null!=_creator  and ''!= _creator">
            and a.creator = #{_creator}
        </if>
        <if test="null!=_update_time  and ''!= _update_time">
            and a.update_time = #{_update_time}
        </if>
        <if test="null!=_updator  and ''!= _updator">
            and a.updator = #{_updator}
        </if>

    </sql>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="map">
        INSERT INTO
        w_order_add (

        <if test="null!=order_no  and ''!= order_no">
            order_no ,
        </if>
        <if test="null!=contract_id  and ''!= contract_id">
            contract_id ,
        </if>
        <if test="null!=coma  and ''!= coma">
            coma ,
        </if>
        <if test="null!=comb  and ''!= comb">
            comb ,
        </if>
        <if test="null!=amount  and ''!= amount">
            amount ,
        </if>
        <if test="null!=start_time  and ''!= start_time">
            start_time ,
        </if>
        <if test="null!=end_time  and ''!= end_time">
            end_time ,
        </if>
        <if test="null!=create_order_time  and ''!= create_order_time">
            create_order_time ,
        </if>
        <if test="null!=create_order_user  and ''!= create_order_user">
            create_order_user ,
        </if>
        <if test="null!=enter_library_time  and ''!= enter_library_time">
            enter_library_time ,
        </if>
        <if test="null!=status">
            status ,
        </if>
        create_time,
        creator,
        update_time,
        updator
        ) VALUES(

        <if test="null!=order_no  and ''!= order_no">
            #{order_no} ,
        </if>
        <if test="null!=contract_id  and ''!= contract_id">
            #{contract_id} ,
        </if>
        <if test="null!=coma  and ''!= coma">
            #{coma} ,
        </if>
        <if test="null!=comb  and ''!= comb">
            #{comb} ,
        </if>
        <if test="null!=amount  and ''!= amount">
            #{amount} ,
        </if>
        <if test="null!=start_time  and ''!= start_time">
            #{start_time} ,
        </if>
        <if test="null!=end_time  and ''!= end_time">
            #{end_time} ,
        </if>
        <if test="null!=create_order_time  and ''!= create_order_time">
            #{create_order_time} ,
        </if>
        <if test="null!=create_order_user  and ''!= create_order_user">
            #{create_order_user} ,
        </if>
        <if test="null!=enter_library_time  and ''!= enter_library_time">
            #{enter_library_time} ,
        </if>
        <if test="null!=status">
            #{status} ,
        </if>
        now(),
        #{creator},
        now(),
        #{updator}
        );
        <selectKey resultType="java.lang.String" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <!-- 删除 -->
    <update id="deleteInfo" parameterType="map">
        UPDATE w_order_add set is_delete = 'Y' where id = #{id}
    </update>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="map">
        UPDATE w_order_add a
        set

        <if test="null!=order_no  and ''!= order_no">
            a.order_no = #{order_no} ,
        </if>
        <if test="null!=contract_id  and ''!= contract_id">
            a.contract_id = #{contract_id} ,
        </if>
        <if test="null!=coma  and ''!= coma">
            a.coma = #{coma} ,
        </if>
        <if test="null!=comb  and ''!= comb">
            a.comb = #{comb} ,
        </if>
        <if test="null!=amount  and ''!= amount">
            a.amount = #{amount} ,
        </if>
        <if test="null!=start_time  and ''!= start_time">
            a.start_time = #{start_time} ,
        </if>
        <if test="null!=end_time  and ''!= end_time">
            a.end_time = #{end_time} ,
        </if>
        <if test="null!=create_order_time  and ''!= create_order_time">
            a.create_order_time = #{create_order_time} ,
        </if>
        <if test="null!=create_order_user  and ''!= create_order_user">
            a.create_order_user = #{create_order_user} ,
        </if>
        <if test="null!=enter_library_time  and ''!= enter_library_time">
            a.enter_library_time = #{enter_library_time} ,
        </if>
        <if test="null!=status">
            a.status = #{status} ,
        </if>
        <if test="null!=create_time  and ''!= create_time">
            a.create_time = #{create_time} ,
        </if>
        <if test="null!=creator  and ''!= creator">
            a.creator = #{creator} ,
        </if>
        <if test="null!=is_delete  and ''!= is_delete">
            a.is_delete = #{is_delete} ,
        </if>
        update_time = now(),
        a.updator = #{updator}
        where
        a.id = #{id}
    </update>

    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        a.id,
        wcp.name AS provider_name,
        wcp2.name AS comb,
        case a.order_type
        when '0' then '订货单'
        when '1' then '补货单'
        when '2' then 'ASN单'
        else '未知' end
        as order_type,
        woa.order_no,
        su.username as creator,
        woa.create_order_time,
        woa.enter_library_time,
        case woa.status
        when '0' then '不同意'
        when '1' then '已同意'
        else '未知' end
        as status
        FROM
        w_order_store_sku a
        LEFT JOIN w_cmn_provider wcp ON wcp.id = a.provider_id
        LEFT JOIN w_order_add woa ON woa.id = a.order_id
        LEFT JOIN w_cmn_provider wcp2 ON wcp2.id = woa.comb
        left join sys_user su ON su.id = woa.creator
        <include refid="sql_where"/>
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        SELECT
        count(1) as total
        FROM
        w_order_store_sku a
        LEFT JOIN w_cmn_provider wcp ON wcp.id = a.provider_id
        LEFT JOIN w_order_add woa ON woa.id = a.order_id
        LEFT JOIN w_cmn_provider wcp2 ON wcp2.id = woa.comb
        left join sys_user su ON su.id = woa.creator
        <include refid="sql_where"/>
    </select>

    <!-- 对象查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        a.*
        FROM
        w_order_add a
        <include refid="sql_where"/>
    </select>
</mapper>
