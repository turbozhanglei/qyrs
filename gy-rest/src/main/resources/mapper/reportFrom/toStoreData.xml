<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="toStoreData">

    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        order_sale.id,
        order_sale.order_no AS sale_order_no,
        sku.name AS sku_name,
        sku.level,
        sku_type.text AS sku_type_1,
        sku_type1.text AS sku_type_2,
        order_sale_sku.measure_unit,
        order_sale_sku.number,
        order_sale_sku.number,
        provider.name,
        provider.address
        FROM
        oms_order_sale_sku order_sale_sku
        LEFT JOIN oms_order_sale order_sale ON order_sale.id = order_sale_sku.order_id
        LEFT JOIN oms_cmn_provider provider ON provider.id = order_sale.comb
        LEFT JOIN oms_sku sku ON sku.id = order_sale_sku.sku_id
        LEFT JOIN oms_sku_type sku_type ON sku_type.id = sku.type_id
        LEFT JOIN oms_sku_type sku_type1 ON sku_type1.id = sku_type.parent_id
        where order_sale_sku.is_delete = 'N'
        <if test="null!=status">
            and order_sale_sku.status = (select id from sys_config where `key` = #{status})
        </if>
        ORDER BY
        order_sale_sku.update_time DESC
    </select>

    <!-- 合计查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        count(sku.name) AS sale_account,
        sum(order_sale_sku.number) AS sale_sku_account
        FROM
        oms_order_sale_sku order_sale_sku
        LEFT JOIN oms_order_sale order_sale ON order_sale.id = order_sale_sku.order_id
        LEFT JOIN oms_cmn_provider provider ON provider.id = order_sale.comb
        LEFT JOIN oms_sku sku ON sku.id = order_sale_sku.sku_id
        LEFT JOIN oms_sku_type sku_type ON sku_type.id = sku.type_id
        LEFT JOIN oms_sku_type sku_type1 ON sku_type1.id = sku_type.parent_id
        where order_sale_sku.is_delete = 'N'
        <if test="null!=status">
            and order_sale_sku.status = (select id from sys_config where `key` = #{status})
        </if>
    </select>
</mapper>
