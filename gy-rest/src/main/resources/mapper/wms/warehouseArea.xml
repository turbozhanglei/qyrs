<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->

<!-- 参数管理手工映射SQL语句 -->
<!-- 库区表信息 -->
<mapper namespace="warehouseArea">

    <sql id="sql_where">
        <if test="null!=_deptid  and ''!= _deptid">
            and a.deptid = #{_deptid}
        </if>
        <if test="null!=_warehouse_id  and ''!= _warehouse_id">
            and a.warehouse_id = #{_warehouse_id}
        </if>
        <if test="null!=number  and ''!= number">
            and a.number LIKE concat('%',#{number},'%')
        </if>
        <if test="null!=name  and ''!= name">
            and a.name LIKE concat('%',#{name},'%')
        </if>
        <if test="null!=charge_person  and ''!= charge_person">
            and a.charge_person LIKE concat('%',#{charge_person},'%')
        </if>
        <if test="null!=status">
            and a.status = #{status}
        </if>
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
    </sql>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="map">
        INSERT INTO
        w_warehouse_area (

        <if test="null!=deptid  and ''!= deptid">
            deptid ,
        </if>
        <if test="null!=warehouse_id  and ''!= warehouse_id">
            warehouse_id ,
        </if>
        <if test="null!=number  and ''!= number">
            number ,
        </if>
        <if test="null!=name  and ''!= name">
            name ,
        </if>
        <if test="null!=type">
            type ,
        </if>
        <if test="null!=charge_person  and ''!= charge_person">
            charge_person ,
        </if>
        <if test="null!=post  and ''!= post">
            post ,
        </if>
        <if test="null!=charge_mobile  and ''!= charge_mobile">
            charge_mobile ,
        </if>
        <if test="null!=telephone  and ''!= telephone">
            telephone ,
        </if>
        <if test="null!=email  and ''!= email">
            email ,
        </if>
        <if test="null!=status">
            status ,
        </if>
        <if test="null!=remark  and ''!= remark">
            remark ,
        </if>
        create_time,
        creator,
        update_time,
        updator
        ) VALUES(

        <if test="null!=deptid  and ''!= deptid">
            #{deptid} ,
        </if>
        <if test="null!=warehouse_id  and ''!= warehouse_id">
            #{warehouse_id} ,
        </if>
        <if test="null!=number  and ''!= number">
            #{number} ,
        </if>
        <if test="null!=name  and ''!= name">
            #{name} ,
        </if>
        <if test="null!=type">
            #{type} ,
        </if>
        <if test="null!=charge_person  and ''!= charge_person">
            #{charge_person} ,
        </if>
        <if test="null!=post  and ''!= post">
            #{post} ,
        </if>
        <if test="null!=charge_mobile  and ''!= charge_mobile">
            #{charge_mobile} ,
        </if>
        <if test="null!=telephone  and ''!= telephone">
            #{telephone} ,
        </if>
        <if test="null!=email  and ''!= email">
            #{email} ,
        </if>
        <if test="null!=status">
            #{status} ,
        </if>
        <if test="null!=remark  and ''!= remark">
            #{remark} ,
        </if>
        now(),
        #{creator},
        now(),
        #{updator}
        );
        <selectKey resultType="java.lang.String" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <!-- 删除 -->
    <update id="deleteInfo" parameterType="map">
        UPDATE w_warehouse_area set is_delete = 'Y' where id = #{id}
    </update>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="map">
        UPDATE w_warehouse_area a
        set

        <if test="null!=deptid  and ''!= deptid">
            a.deptid = #{deptid} ,
        </if>
        <if test="null!=warehouse_id  and ''!= warehouse_id">
            a.warehouse_id = #{warehouse_id} ,
        </if>
        <if test="null!=number  and ''!= number">
            a.number = #{number} ,
        </if>
        <if test="null!=name  and ''!= name">
            a.name = #{name} ,
        </if>
        <if test="null!=type">
            a.type = #{type} ,
        </if>
        <if test="null!=charge_person  and ''!= charge_person">
            a.charge_person = #{charge_person} ,
        </if>
        <if test="null!=post  and ''!= post">
            a.post = #{post} ,
        </if>
        <if test="null!=charge_mobile  and ''!= charge_mobile">
            a.charge_mobile = #{charge_mobile} ,
        </if>
        <if test="null!=telephone  and ''!= telephone">
            a.telephone = #{telephone} ,
        </if>
        <if test="null!=email  and ''!= email">
            a.email = #{email} ,
        </if>
        <if test="null!=status">
            a.status = #{status} ,
        </if>
        <if test="null!=remark  and ''!= remark">
            a.remark = #{remark} ,
        </if>
        <if test="null!=create_time  and ''!= create_time">
            a.create_time = #{create_time} ,
        </if>
        <if test="null!=creator  and ''!= creator">
            a.creator = #{creator} ,
        </if>
        <if test="null!=is_delete  and ''!= is_delete">
            a.is_delete = #{is_delete} ,
        </if>
        update_time = now(),
        a.updator = #{updator}
        where
        a.id = #{id}
    </update>

    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        a.*, s.val AS typeval,
        sc.val AS statusval,
        b.`name` as warehouse_name,
        concat(b.number,a.number) as warehouse_number
        FROM
        w_warehouse_area a
        LEFT JOIN sys_config s ON s.id = a.type
        LEFT JOIN sys_config sc ON sc.id = a. STATUS
        LEFT JOIN w_warehouse b ON a.warehouse_id = b.id
        WHERE
        1 = 1
        AND a.is_delete = 'N'
        <include refid="sql_where"/>
        HAVING 1 = 1
        <if test="null!=warehouse_number  and ''!= warehouse_number">
            and warehouse_number LIKE  concat('%',#{warehouse_number},'%')
        </if>
        ORDER BY a.id DESC
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 下拉列表查询 -->
    <select id="queryBoxList" parameterType="map" resultType="dto">
        SELECT
        a.id,
        a.name
        FROM w_warehouse_area a
        WHERE 1 = 1 AND a.is_delete = 'N'
        <include refid="sql_where"/>
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        SELECT count(1) as total,   concat(b.number,a.number) as warehouse_number
        FROM w_warehouse_area a
        LEFT JOIN w_warehouse b ON a.warehouse_id = b.id
        WHERE 1 = 1 AND a.is_delete = 'N'
        <include refid="sql_where"/>
        HAVING 1 = 1
        <if test="null!=warehouse_number  and ''!= warehouse_number">
           and warehouse_number LIKE  concat('%',#{warehouse_number},'%')
        </if>
    </select>

    <!-- 对象查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT a.*,s.val as typeval,sc.val as statusval
        FROM w_warehouse_area a
        left join sys_config s on s.id = a.type
        left join sys_config sc on sc.id = a.status
        WHERE 1 = 1 AND a.is_delete = 'N'
        <include refid="sql_where"/>
        limit 1
    </select>
</mapper>
