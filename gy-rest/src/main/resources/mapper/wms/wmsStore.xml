<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="wmsStore">


    <sql id="sql_where">
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
    </sql>

    <!-- 查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        a.*,p.name AS providerName ,w.name AS warehousName,st.text,u.username,s.name AS skuName,s.level,
        s.status as updown,c.val as storelimit,d.val as realstorestatus
        FROM
        wms_store a
        LEFT JOIN oms_cmn_provider p ON a.supplier_id = p.id
        LEFT JOIN wms_warehouse w ON a.warehous_id = w.id
        LEFT JOIN oms_sku s ON a.sku_id = s.id
        LEFT JOIN oms_sku_type st ON s.type_id = st.id
        LEFT JOIN sys_user u ON a.creator = u.id
        LEFT JOIN sys_config c ON c.id=a.store_limit
        LEFT JOIN sys_config d ON d.id=a.real_store_status
        WHERE
        1 = 1
        AND a.is_delete = 'N'
        <include refid="sql_where"/>
        <if test="null!=userName  and ''!= userName">
            and u.username LIKE CONCAT('%', #{userName}, '%')
        </if>
        <if test="null!=number  and ''!= number">
            and s.number LIKE CONCAT('%', #{number}, '%')
        </if>
        <if test="null!=supplier_id2  and ''!= supplier_id2">
            and p.name LIKE CONCAT('%', #{supplier_id2}, '%')
        </if>
        <if test="null!=warehous_id1  and ''!= warehous_id1">
            and w.name LIKE CONCAT('%', #{warehous_id1}, '%')
        </if>
        <if test="null!=sku_id1  and ''!= sku_id1">
            and s.name LIKE CONCAT('%', #{sku_id1}, '%')
        </if>
        <if test="null!=skuStatus  and ''!= skuStatus">
            and s.status = #{skuStatus}
        </if>
        <if test="null!=storelimit  and ''!= storelimit">
            and storelimit = #{storelimit}
        </if>
        <if test="null!=realstorestatus  and ''!= realstorestatus">
            and realstorestatus = #{realstorestatus}
        </if>
        <if test="null!=updown  and ''!= updown">
            and updown = #{updown}
        </if>
        <if test="null!=warehous_id2  and ''!= warehous_id2">
            and a.warehous_id = #{warehous_id2}
        </if>
        <if test="null!=number1  and ''!= number1">
            and s.number = #{number1}
        </if>
        <if test="null!=supplier_id1  and ''!= supplier_id1">
            and a.supplier_id = #{supplier_id1}
        </if>
        ORDER BY a.id
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        SELECT
        count(1) as total
        FROM
        wms_store a
        <include refid="sql_where"/>
    </select>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        insert into wms_store
        (sku_id,supplier_id,warehous_id,store_sale,store_actual,store_save,store_copy,store_limit,real_store_status,create_time,creator,update_time,updator,is_delete)
        values
        (#{sku_id},#{supplier_id},#{warehous_id},#{store_sale},#{store_actual},#{store_save},#{store_copy},#{store_limit},#{real_store_status},now(),#{creator},now(),#{updator},'N')
    </insert>

    <!-- 删除 -->
    <delete id="deleteInfo" parameterType="map">
        UPDATE wms_store set is_delete = 'Y' WHERE id = #{id}
    </delete>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        update wms_store
        set
        <if test="null!=sku_id  and ''!= sku_id">
            sku_id = #{sku_id},
        </if>
        <if test="null!=supplier_id  and ''!= supplier_id">
            supplier_id = #{supplier_id},
        </if>
        <if test="null!=warehous_id  and ''!= warehous_id">
            warehous_id = #{warehous_id},
        </if>
        <if test="null!=store_sale1  and ''!= store_sale1">
            store_sale = #{store_sale1},
        </if>
        <if test="null!=store_actual1  and ''!= store_actual1">
            store_actual = #{store_actual1},
        </if>
        <if test="null!=store_save1  and ''!= store_save1">
            store_save = #{store_save1},
        </if>
        <if test="null!=store_copy1  and ''!= store_copy1">
            store_copy = #{store_copy1},
        </if>
        update_time = now(),
        updator = #{updator}
        where id = #{id}
    </update>

    <!-- 查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        a.*,p.name AS providerName ,w.name AS warehousName,st.text,st.id as oms_sku_typeid,u.username,s.name AS
        skuName,s.level,
        s.status as updown, s.number as number,c.val as storelimit,d.val as realstorestatus
        FROM
        wms_store a
        LEFT JOIN oms_cmn_provider p ON a.supplier_id = p.id
        LEFT JOIN wms_warehouse w ON a.warehous_id = w.id
        LEFT JOIN oms_sku s ON a.sku_id = s.id
        LEFT JOIN oms_sku_type st ON s.type_id = st.id
        LEFT JOIN sys_user u ON a.creator = u.id
        LEFT JOIN sys_config c ON c.id=a.store_limit
        LEFT JOIN sys_config d ON d.id=a.real_store_status
        WHERE
        1 = 1
        AND a.is_delete = 'N'
        <include refid="sql_where"/>
        limit 0,1
    </select>


</mapper>
