<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->

<!-- 参数管理手工映射SQL语句 -->
<!-- 结算单表 -->
<mapper namespace="wAccountReceive">

    <sql id="sql_where">
        where
        a.is_delete = 'N'
        <if test="null!=_id  and ''!= _id">
            and a.id = #{_id}
        </if>
        <if test="null!=_settlement_number  and ''!= _settlement_number">
            and a.settlement_number = #{_settlement_number}
        </if>
        <if test="null!=_company_name  and ''!= _company_name">
            and ca.company_name = #{_company_name}
        </if>
        <if test="null!=_settlement_object  and ''!= _settlement_object">
            and a.settlement_object = #{_settlement_object}
        </if>
        <if test="null!=_currency  and ''!= _currency">
            and a.currency = #{_currency}
        </if>
        <if test="null!=_amount_of_money  and ''!= _amount_of_money">
            and a.amount_of_money = #{_amount_of_money}
        </if>
        <if test="null!=_type  and ''!= _type">
            and a.type = #{_type}
        </if>
        <if test="null!=_status  and ''!= _status">
            and a.status = #{_status}
        </if>
        <if test="null!=_handle  and ''!= _handle">
            and a.handle LIKE concat('%', #{_handle}, '%')
        </if>
        <if test="null!=_examine  and ''!= _examine">
            and a.examine LIKE concat('%', #{_examine}, '%')
        </if>
        <if test="null!=_check  and ''!= _check">
            and a.`check` LIKE concat('%', #{_check}, '%')
        </if>
        <if test="null!=_check_time  and ''!= _check_time">
            and a.check_time = #{_check_time}
        </if>
        <if test="null!=_remark  and ''!= _remark">
            and a.remark = #{_remark}
        </if>
        <if test="null!=startDate  and ''!= startDate">
            and a.create_time >= concat(#{startDate},' ','00:00:00')
        </if>
        <if test="null!=endDate  and ''!= endDate">
            and a.create_time &lt;= concat(#{endDate},' ','23:59:59')
        </if>
        <if test="null!=_creator  and ''!= _creator">
            and a.creator = #{_creator}
        </if>
        <if test="null!=_update_time  and ''!= _update_time">
            and a.update_time = #{_update_time}
        </if>
        <if test="null!=_updator  and ''!= _updator">
            and a.updator = #{_updator}
        </if>

    </sql>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="map">
        INSERT INTO
        w_account_receive (

        <if test="null!=settlement_number  and ''!= settlement_number">
            settlement_number ,
        </if>
        <if test="null!=settlement_object  and ''!= settlement_object">
            settlement_object ,
        </if>
        <if test="null!=currency  and ''!= currency">
            currency ,
        </if>
        <if test="null!=amount_of_money  and ''!= amount_of_money">
            amount_of_money ,
        </if>
        <if test="null!=type">
            `type` ,
        </if>
        <if test="null!=status">
            status ,
        </if>
        <if test="null!=handle  and ''!= handle">
            handle ,
        </if>
        <if test="null!=examine  and ''!= examine">
            examine ,
        </if>
        <if test="null!=check  and ''!= check">
            `check` ,
        </if>
        <if test="null!=check_time  and ''!= check_time">
            check_time ,
        </if>
        <if test="null!=remark  and ''!= remark">
            remark ,
        </if>
        create_time,
        creator,
        update_time,
        updator
        ) VALUES(

        <if test="null!=settlement_number  and ''!= settlement_number">
            #{settlement_number} ,
        </if>
        <if test="null!=settlement_object  and ''!= settlement_object">
            #{settlement_object} ,
        </if>
        <if test="null!=currency  and ''!= currency">
            #{currency} ,
        </if>
        <if test="null!=amount_of_money  and ''!= amount_of_money">
            #{amount_of_money} ,
        </if>
        <if test="null!=type">
            #{type} ,
        </if>
        <if test="null!=status">
            #{status} ,
        </if>
        <if test="null!=handle  and ''!= handle">
            #{handle} ,
        </if>
        <if test="null!=examine  and ''!= examine">
            #{examine} ,
        </if>
        <if test="null!=check  and ''!= check">
            #{check} ,
        </if>
        <if test="null!=check_time  and ''!= check_time">
            #{check_time} ,
        </if>
        <if test="null!=remark  and ''!= remark">
            #{remark} ,
        </if>
        now(),
        creator,
        now(),
        updator
        );
        <selectKey resultType="java.lang.String" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <!-- 删除 -->
    <update id="deleteInfo" parameterType="map">
        UPDATE w_account_receive set is_delete = 'Y' where id = #{id}
    </update>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="map">
        UPDATE w_account_receive a
        set

        <if test="null!=settlement_number  and ''!= settlement_number">
            a.settlement_number = #{settlement_number} ,
        </if>
        <if test="null!=settlement_object  and ''!= settlement_object">
            a.settlement_object = #{settlement_object} ,
        </if>
        <if test="null!=currency  and ''!= currency">
            a.currency = #{currency} ,
        </if>
        <if test="null!=amount_of_money  and ''!= amount_of_money">
            a.amount_of_money = #{amount_of_money} ,
        </if>
        <if test="null!=handle  and ''!= handle">
            a.handle = #{handle} ,
        </if>
        <if test="null!=examine  and ''!= examine">
            a.examine = #{examine} ,
        </if>
        <if test="null!=check  and ''!= check">
            a.`check` = #{check} ,
        </if>
        <if test="null!=check_time  and ''!= check_time">
            a.check_time = #{check_time} ,
        </if>
        <if test="null!=remark  and ''!= remark">
            a.remark = #{remark} ,
        </if>
        <if test="null!=create_time  and ''!= create_time">
            a.create_time = #{create_time} ,
        </if>
        <if test="null!=creator  and ''!= creator">
            a.creator = #{creator} ,
        </if>
        <if test="null!=is_delete  and ''!= is_delete">
            a.is_delete = #{is_delete} ,
        </if>
        update_time = now(),
        a.updator = #{updator},
        a.status = 2
        where
        a.id = #{id}
    </update>

    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        a.id,
        a.settlement_number,
        ca.company_name,
        sc.val as currency,
        a.amount_of_money,
        case a.status
        when '1' then '创建'
        when '2' then '修改'
        else '未知'
        end as status,
        a.handle,
        a.examine,
        a.`check`,
        a.check_time,
        a.remark,
        a.create_time
        FROM
        w_account_receive a
        left join company_account ca on ca.id = a.settlement_object
        left join sys_config sc on sc.id = a.currency
        <include refid="sql_where"/>
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        SELECT
        count(1) as total
        FROM
        w_account_receive a
        <include refid="sql_where"/>
    </select>

    <!-- 对象查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        a.*
        FROM
        w_account_receive a
        <include refid="sql_where"/>
    </select>
</mapper>
