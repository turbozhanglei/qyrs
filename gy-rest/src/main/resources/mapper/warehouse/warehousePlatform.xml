<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="warehousePlatform">


    <sql id="sql_where">
        <if test="null!=number  and ''!= number">
            and a.number LIKE concat('%',#{number},'%')
        </if>
        <if test="null!=name  and ''!= name">
            and a.name LIKE concat('%',#{name},'%')
        </if>
        <if test="null!=warehousename  and ''!= warehousename">
            and b.name LIKE concat('%',#{warehousename},'%')
        </if>
        <if test="null!=status">
            and a.status = #{status}
        </if>
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
    </sql>

    <!-- 查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT a.*,b.`name` as warehousename,c.`name` as areaval,s.val as platformtype
        FROM w_warehouse_platform a
        LEFT JOIN w_warehouse b on a.warehouse_id = b.id
        LEFT JOIN w_warehouse_area c on a.area_id = c.id
        LEFT JOIN sys_config s on a.platform_type = s.id
        WHERE 1 = 1 AND a.is_delete = 'N'
        <include refid="sql_where"/>
        ORDER BY id
        <if test="null!=start">
            limit ${start},${end}
        </if>
    </select>

    <!-- 查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT a.*,b.`name` as warehousename,c.`name` as areaval,s.val as platformtype
        FROM w_warehouse_platform a
        LEFT JOIN w_warehouse b on a.warehouse_id = b.id
        LEFT JOIN w_warehouse_area c on a.area_id = c.id
        LEFT JOIN sys_config s on a.platform_type = s.id
        WHERE 1 = 1 AND a.is_delete = 'N'
        <include refid="sql_where"/>
        limit 0,1
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        select
        count(1) as total
        FROM w_warehouse_platform a
        LEFT JOIN w_warehouse b on a.warehouse_id = b.id
        LEFT JOIN w_warehouse_area c on a.area_id = c.id
        LEFT JOIN sys_config s on a.platform_type = s.id
        WHERE 1 = 1 AND a.is_delete = 'N'
        <include refid="sql_where"/>
    </select>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        insert into w_warehouse_platform (warehouse_id, area_id,
        platform_type, number, name,
        forthputting, acreage, serial_number,
        working_time_start1, working_time_end1,
        working_time_start2, working_time_end2,
        use_status, status, remark,
        create_time, creator, is_delete)
        values (#{warehouse_id}, #{area_id},
        #{platform_type}, #{number}, #{name},
        #{forthputting}, #{acreage}, #{serial_number},
        #{working_time_start1}, #{working_time_end1},
        #{working_time_start2}, #{working_time_end2},
        #{use_status}, #{status}, #{remark},
        now(), #{creator}, 'N')

    </insert>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        update w_warehouse_platform
        set
        <if test="null!=warehouse_id  and ''!= warehouse_id">
            warehouse_id = #{warehouse_id},
        </if>
        <if test="null!=area_id  and ''!= area_id">
            area_id = #{area_id},
        </if>
        <if test="null!=platform_type  and ''!= platform_type">
            platform_type = #{platform_type},
        </if>
        <if test="null!=number  and ''!= number">
            number = #{number},
        </if>
        <if test="null!=name  and ''!= name">
            name = #{name},
        </if>
        <if test="null!=forthputting  and ''!= forthputting">
            forthputting = #{forthputting},
        </if>
        <if test="null!=acreage  and ''!= acreage">
            acreage = #{acreage},
        </if>
        <if test="null!=serial_number  and ''!= serial_number">
            serial_number = #{serial_number},
        </if>
        <if test="null!=working_time_start1  and ''!= working_time_start1">
            working_time_start1 = #{working_time_start1},
        </if>
        <if test="null!=working_time_end1  and ''!= working_time_end1">
            working_time_end1 = #{working_time_end1},
        </if>
        <if test="null!=working_time_start2  and ''!= working_time_start2">
            working_time_start2 = #{working_time_start2},
        </if>
        <if test="null!=working_time_end2  and ''!= working_time_end2">
            working_time_end2 = #{working_time_end2},
        </if>
        <if test="null!=use_status  and ''!= use_status">
            use_status = #{use_status},
        </if>
        <if test="null!=status">
            status = #{status},
        </if>
        <if test="null!=remark  and ''!= remark">
            remark = #{remark},
        </if>
        <if test="null!=updator  and ''!= updator">
            updator = #{updator},
        </if>
        update_time = now()
        where id = #{id}
    </update>

    <!-- 删除 -->
    <delete id="deleteInfo" parameterType="map">
        UPDATE w_warehouse_platform set is_delete = 'Y' WHERE id = #{id}
    </delete>

</mapper>
