<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="saleOrder">


    <sql id="sql_where">
        <if test="null!=status">
            and a.status = #{status}
        </if>
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
    </sql>
    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        a.*,
        s.val AS ordertype,
        ca.val AS carriername,
        cp.`name` as provider_name,
        cps.`name` as provider_owner_name,
        ww.`name` as warehouse_name,
        sc.val as priorityval,
        cf.val as statusval
        FROM
        w_order_sale a
        LEFT JOIN sys_config ca ON a.carrier = ca.id
        LEFT JOIN sys_config s ON a.order_type = s.id
        LEFT JOIN w_cmn_provider cp ON a.provider_carrier_id = cp.id
        LEFT JOIN w_cmn_provider cps ON a.provider_owner_id = cps.id
        LEFT JOIN w_warehouse as ww on ww.id=a.shipping_warehouse_id
        LEFT JOIN sys_config as sc on sc.id=a.priority
        LEFT JOIN sys_config cf on a.`status` = cf.id
        WHERE a.is_delete = 'N'
        and a.status = 731
        <include refid="sql_where"/>
        ORDER BY a.id
    </select>

    <!-- 对象查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        order_sale.id,
        order_sale.order_no,
        order_sale.contract_id,
        provider.id as provider_coma,
        provider. NAME AS coma,
        provider1.id as provider_comb,
        provider1. NAME AS comb,
        order_sale.amount,
        order_sale.start_time,
        order_sale.end_time,
        order_sale.create_order_time,
        order_sale.create_order_user,
        order_sale.out_library_time
        FROM
        oms_order_sale order_sale
        LEFT JOIN oms_cmn_provider provider ON provider.id = order_sale.coma
        LEFT JOIN oms_cmn_provider provider1 ON provider1.id = order_sale.comb
        where
        order_sale.id= #{id}
    </select>

    <select id="queryListCount" parameterType="map" resultType="dto">
        select
        count(1) as total
        from w_order_sale a
        LEFT JOIN sys_config ca ON a.carrier = ca.id
        LEFT JOIN sys_config s ON a.order_type = s.id
        LEFT JOIN w_cmn_provider cp ON a.provider_carrier_id = cp.id
        LEFT JOIN w_cmn_provider cps ON a.provider_owner_id = cps.id
        LEFT JOIN w_warehouse as ww on ww.id=a.shipping_warehouse_id
        LEFT JOIN sys_config as sc on sc.id=a.priority
        LEFT JOIN sys_config cf on a.`status` = cf.id
        WHERE a.is_delete = 'N'
        <include refid="sql_where"/>
    </select>
</mapper>
