<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->

<!-- 参数管理手工映射SQL语句 -->
<!-- 结算单费用明细表 -->
<mapper namespace="wAccountReceiveDetail">

    <sql id="sql_where">
        where
        a.is_delete = 'N'
        <if test="null!=_id  and ''!= _id">
            and a.id = #{_id}
        </if>
        <if test="null!=_account_receive_id  and ''!= _account_receive_id">
            and a.account_receive_id = #{_account_receive_id}
        </if>
        <if test="null!=_cost_type  and ''!= _cost_type">
            and a.cost_type = #{_cost_type}
        </if>
        <if test="null!=_business_number  and ''!= _business_number">
            and a.business_number = #{_business_number}
        </if>
        <if test="null!=_traffic_volume  and ''!= _traffic_volume">
            and a.traffic_volume = #{_traffic_volume}
        </if>
        <if test="null!=_price  and ''!= _price">
            and a.price = #{_price}
        </if>
        <if test="null!=_discount  and ''!= _discount">
            and a.discount = #{_discount}
        </if>
        <if test="null!=_settlement_amount  and ''!= _settlement_amount">
            and a.settlement_amount = #{_settlement_amount}
        </if>
        <if test="null!=_remark  and ''!= _remark">
            and a.remark = #{_remark}
        </if>
        <if test="null!=startDate  and ''!= startDate">
            and a.create_time >= concat(#{startDate},' ','00:00:00')
        </if>
        <if test="null!=endDate  and ''!= endDate">
            and a.create_time &lt;= concat(#{endDate},' ','23:59:59')
        </if>
        <if test="null!=_creator  and ''!= _creator">
            and a.creator = #{_creator}
        </if>
        <if test="null!=_update_time  and ''!= _update_time">
            and a.update_time = #{_update_time}
        </if>
        <if test="null!=_updator  and ''!= _updator">
            and a.updator = #{_updator}
        </if>

    </sql>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="map">
        INSERT INTO
        w_account_receive_detail (

        <if test="null!=sort  and ''!= sort">
            sort ,
        </if>
        <if test="null!=account_receive_id  and ''!= account_receive_id">
            account_receive_id ,
        </if>
        <if test="null!=cost_type  and ''!= cost_type">
            cost_type ,
        </if>
        <if test="null!=business_number  and ''!= business_number">
            business_number ,
        </if>
        <if test="null!=traffic_volume  and ''!= traffic_volume">
            traffic_volume ,
        </if>
        <if test="null!=price  and ''!= price">
            price ,
        </if>
        <if test="null!=discount  and ''!= discount">
            discount ,
        </if>
        <if test="null!=settlement_amount  and ''!= settlement_amount">
            settlement_amount ,
        </if>
        <if test="null!=remark  and ''!= remark">
            remark ,
        </if>
        create_time,
        creator,
        update_time,
        updator
        ) VALUES(

        <if test="null!=sort  and ''!= sort">
            #{sort} ,
        </if>
        <if test="null!=account_receive_id  and ''!= account_receive_id">
            #{account_receive_id} ,
        </if>
        <if test="null!=cost_type  and ''!= cost_type">
            #{cost_type} ,
        </if>
        <if test="null!=business_number  and ''!= business_number">
            #{business_number} ,
        </if>
        <if test="null!=traffic_volume  and ''!= traffic_volume">
            #{traffic_volume} ,
        </if>
        <if test="null!=price  and ''!= price">
            #{price} ,
        </if>
        <if test="null!=discount  and ''!= discount">
            #{discount} ,
        </if>
        <if test="null!=settlement_amount  and ''!= settlement_amount">
            #{settlement_amount} ,
        </if>
        <if test="null!=remark  and ''!= remark">
            #{remark} ,
        </if>
        now(),
        creator,
        now(),
        updator
        );
        <selectKey resultType="java.lang.String" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <!-- 删除 -->
    <update id="deleteInfo" parameterType="map">
        UPDATE w_account_receive_detail set is_delete = 'Y' where id = #{id}
    </update>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="map">
        UPDATE w_account_receive_detail a
        set

        <if test="null!=account_receive_id  and ''!= account_receive_id">
            a.account_receive_id = #{account_receive_id} ,
        </if>
        <if test="null!=cost_type  and ''!= cost_type">
            a.cost_type = #{cost_type} ,
        </if>
        <if test="null!=business_number  and ''!= business_number">
            a.business_number = #{business_number} ,
        </if>
        <if test="null!=traffic_volume  and ''!= traffic_volume">
            a.traffic_volume = #{traffic_volume} ,
        </if>
        <if test="null!=price  and ''!= price">
            a.price = #{price} ,
        </if>
        <if test="null!=discount  and ''!= discount">
            a.discount = #{discount} ,
        </if>
        <if test="null!=settlement_amount  and ''!= settlement_amount">
            a.settlement_amount = #{settlement_amount} ,
        </if>
        <if test="null!=remark  and ''!= remark">
            a.remark = #{remark} ,
        </if>
        <if test="null!=create_time  and ''!= create_time">
            a.create_time = #{create_time} ,
        </if>
        <if test="null!=creator  and ''!= creator">
            a.creator = #{creator} ,
        </if>
        <if test="null!=is_delete  and ''!= is_delete">
            a.is_delete = #{is_delete} ,
        </if>
        update_time = now(),
        a.updator = #{updator}
        where
        a.id = #{id}
    </update>

    <!-- 列表查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        a.id,
        a.sort,
        a.account_receive_id,
        sc.val as cost_type,
        a.business_number,
        a.traffic_volume,
        a.price,
        a.discount,
        a.settlement_amount,
        a.remark,
        a.create_time
        FROM
        w_account_receive_detail a
        left join sys_config sc on sc.id = a.cost_type
        <include refid="sql_where"/>
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        SELECT
        count(1) as total
        FROM
        w_account_receive_detail a
        <include refid="sql_where"/>
    </select>

    <!-- 对象查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        a.*
        FROM
        w_account_receive_detail a
        <include refid="sql_where"/>
    </select>
</mapper>
