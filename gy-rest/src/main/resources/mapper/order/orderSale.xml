<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="orderSale">


    <sql id="sql_where">
        <if test="null!=status">
            and a.status = #{status}
        </if>
        <if test="null!=number  and ''!= number">
            and a.number = #{number}
        </if>
        <if test="null!=id  and ''!= id">
            and a.id = #{id}
        </if>
    </sql>

    <!-- 查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        a.*,
        s.val AS ordertype,
        ca.val AS carriername,
        cp.`name` as provider_name,
        cps.`name` as provider_owner_name,
        ww.`name` as warehouse_name,
        sc.val as priorityval,
        cf.val as statusval
        FROM
        w_order_sale a
        LEFT JOIN sys_config ca ON a.carrier = ca.id
        LEFT JOIN sys_config s ON a.order_type = s.id
        LEFT JOIN w_cmn_provider cp ON a.provider_carrier_id = cp.id
        LEFT JOIN w_cmn_provider cps ON a.provider_owner_id = cps.id
        LEFT JOIN w_warehouse as ww on ww.id=a.shipping_warehouse_id
        LEFT JOIN sys_config as sc on sc.id=a.priority
        LEFT JOIN sys_config cf on a.`status` = cf.id
        WHERE a.is_delete = 'N'
        <include refid="sql_where"/>
        ORDER BY a.id
        <if test="null!=start">
            limit #{start},#{end}
        </if>
    </select>

    <!-- 列表数量查询 -->
    <select id="queryListCount" parameterType="map" resultType="dto">
        select
        count(1) as total
        FROM
        w_order_sale a
        LEFT JOIN sys_config ca ON a.carrier = ca.id
        LEFT JOIN sys_config s ON a.order_type = s.id
        LEFT JOIN w_cmn_provider cp ON a.provider_carrier_id = cp.id
        LEFT JOIN w_cmn_provider cps ON a.provider_owner_id = cps.id
        LEFT JOIN w_warehouse as ww on ww.id=a.shipping_warehouse_id
        LEFT JOIN sys_config as sc on sc.id=a.priority
        LEFT JOIN sys_config cf on a.`status` = cf.id
        WHERE a.is_delete = 'N'
        <include refid="sql_where"/>
    </select>

    <!-- 查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        a.*,
        s.val AS ordertype,
        ca.val AS carriername,
        cp.`name` as provider_name,
        cps.`name` as provider_owner_name,
        ww.`name` as warehouse_name,
        sc.val as priorityval
        FROM
        w_order_sale a
        LEFT JOIN sys_config ca ON a.carrier = ca.id
        LEFT JOIN sys_config s ON a.order_type = s.id
        LEFT JOIN w_cmn_provider cp ON a.provider_carrier_id = cp.id
        LEFT JOIN w_cmn_provider cps ON a.provider_owner_id = cps.id
        LEFT JOIN w_warehouse as ww on ww.id=a.shipping_warehouse_id
        LEFT JOIN sys_config as sc on sc.id=a.priority
        LEFT JOIN sys_config cf on a.`status` = cf.id
        WHERE a.is_delete = 'N'
        <include refid="sql_where"/>
        limit 0,1
    </select>


    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        insert into w_order_sale
        (
        order_no,
        order_type,
        provider_id,
        provider_carrier_id,
        provider_owner_id,
        carrier,
        contract_id,
        coma,
        comb,
        priority,
        start_time,
        end_time,
        seller,
        shipping_warehouse_id,
        receive,
        partial_shipments,
        remark,
        status,
        create_time,
        creator,
        is_delete
        )
        values (
        #{order_no},
        #{order_type},
        #{provider_id},
        #{provider_carrier_id},
        #{provider_owner_id},
        #{carrier},
        #{contract_id},
        #{coma},
        #{comb},
        #{priority},
        #{start_time},
        #{end_time},
        #{seller},
        #{shipping_warehouse_id},
        #{receive},
        #{partial_shipments},
        #{remark},
        725,
        now(),
        #{creator},
        'N'
        )
        <selectKey resultType="java.lang.String" keyProperty="id">
            SELECT LAST_INSERT_ID() as id
        </selectKey>
    </insert>

    <!-- 修改 -->
    <update id="updateInfo" parameterType="dto">
        update w_order_sale
        set
        <if test="null!=order_no  and ''!= order_no">
            order_no = #{order_no},
        </if>
        <if test="null!=order_type  and ''!= order_type">
            order_type = #{order_type},
        </if>
        <if test="null!=provider_id  and ''!= provider_id">
            provider_id = #{provider_id},
        </if>
        <if test="null!=provider_carrier_id  and ''!= provider_carrier_id">
            provider_carrier_id = #{provider_carrier_id},
        </if>
        <if test="null!=provider_owner_id  and ''!= provider_owner_id">
            provider_owner_id = #{provider_owner_id},
        </if>
        <if test="null!=carrier  and ''!= carrier">
            carrier = #{carrier},
        </if>
        <if test="null!=contract_id  and ''!= contract_id">
            contract_id = #{contract_id},
        </if>
        <if test="null!=coma  and ''!= coma">
            coma = #{coma},
        </if>
        <if test="null!=comb  and ''!= comb">
            comb = #{comb},
        </if>
        <if test="null!=priority  and ''!= priority">
            priority = #{priority},
        </if>
        <if test="null!=order_no  and ''!= order_no">
            start_time = #{start_time},
        </if>
        <if test="null!=end_time  and ''!= end_time">
            end_time = #{end_time},
        </if>
        <if test="null!=seller  and ''!= seller">
            seller = #{seller},
        </if>
        <if test="null!=shipping_warehouse_id  and ''!= shipping_warehouse_id">
            shipping_warehouse_id = #{shipping_warehouse_id},
        </if>
        <if test="null!=receive  and ''!= receive">
            receive = #{receive},
        </if>
        <if test="null!=partial_shipments  and ''!= partial_shipments">
            partial_shipments = #{partial_shipments},
        </if>
        <if test="null!=remark  and ''!= remark">
            remark = #{remark},
        </if>
        <if test="null!=status">
            status = #{status},
        </if>
        <if test="null!=updator  and ''!= updator">
            updator = #{updator},
        </if>
        update_time = now()
        where id = #{id}
    </update>

    <!-- 删除 -->
    <delete id="deleteInfo" parameterType="map">
        UPDATE w_order_sale set is_delete = 'Y' WHERE id = #{id}
    </delete>

</mapper>
