<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!-- 参数管理手工映射SQL语句 -->
<!-- 参数管理手工映射SQL语句 -->
<mapper namespace="store">


    <!-- 商品类别查询 -->
    <select id="queryList" parameterType="map" resultType="dto">
        SELECT
        store.id,
        store.order_no,
        store.comb,
        provider_comb.`name` AS provider_comb_name,
        sale_sku.sku_id,
        sku.name as sku_name,
        store.address,
        sale.order_no AS sqle_order_no,
        store.warehouse_id,
        warehouse.`name` AS warehouse_name,
        provider_logistics.`name` AS logistics_name,
        config.val as status,
        store.to_time,
        store.remark
        FROM
        oms_order_tostore store
        LEFT JOIN oms_cmn_provider provider_comb ON provider_comb.id = store.comb
        LEFT JOIN oms_order_sale sale ON sale.id = store.buysale_id
        LEFT JOIN oms_order_sale_sku sale_sku ON sale_sku.order_id = sale.id
        LEFT JOIN oms_sku sku ON sku.id = sale_sku.sku_id
        LEFT JOIN wms_warehouse warehouse ON warehouse.id = store.warehouse_id
        LEFT JOIN oms_cmn_provider provider_logistics ON provider_logistics.id = store.provider_id
        LEFT JOIN sys_config config ON config.id = store. STATUS
        WHERE
        store.is_delete = 'N'
        <if test="null!=_begin_time">
            and store.to_time BETWEEN ''
        </if>
        <if test="null!=_begin_time  and ''!= _begin_time">
            and store.to_time BETWEEN #{_begin_time}
        </if>
        <if test="null!=_end_time">
            and now()
        </if>
        <if test="null!=_end_time  and ''!= _end_time">
            and #{_end_time}
        </if>

        <if test="null!=_order_no  and ''!= _order_no">
            and store.order_no = #{_order_no}
        </if>
        <if test="null!=_comb  and ''!= _comb">
            and provider_comb_name LIKE concat('%',#{_comb},'%')
        </if>
        <if test="null!=_type_id  and ''!= _type_id">
            and status = #{_type_id}
        </if>
        <if test="null!=_warehouse_name  and ''!= _warehouse_name">
            and warehouse_name LIKE concat('%',#{_warehouse_name},'%')
        </if>
        <if test="null!=_sku_name  and ''!= _sku_name">
            and sku.name LIKE concat('%',#{_sku_name},'%')
        </if>
        order by store.update_time desc
    </select>

    <!-- 对象查询 -->
    <select id="getInfo" parameterType="map" resultType="dto">
        SELECT
        store.order_no AS tostore_order_no,
        store.buysale_id AS sale_order_id,
        provider_comb.`name` AS comb,
        store.address,
        store.warehouse_id,
        store.provider_id AS provider_logistics,
        store.to_time,
        store.remark
        FROM
        oms_order_tostore store
        LEFT JOIN oms_cmn_provider provider_comb ON provider_comb.id = store.comb
        WHERE
        store.is_delete = 'N'
        and store.id= #{id}
    </select>

    <!-- 插入 -->
    <insert id="saveInfo" parameterType="dto">
        INSERT INTO oms_order_tostore (
        create_time,
        update_time,
        <if test="null!=order_no  and ''!= order_no">order_no</if>
        <if test="null!=warehouse_id  and ''!= warehouse_id">warehouse_id ,</if>
        <if test="null!=sale_order_id  and ''!= sale_order_id">buysale_id ,</if>
        <if test="null!=comb_id  and ''!= comb_id">comb ,</if>
        <if test="null!=provider_logistics  and ''!= provider_logistics">provider_id ,</if>
        <if test="null!=address  and ''!= address">address ,</if>
        <if test="null!=to_time  and ''!= to_time">to_time ,</if>
        <if test="null!=order_status  and ''!= order_status">status ,</if>
        <if test="null!=remark  and ''!= remark">remark ,</if>
        <if test="null!=creator  and ''!= creator">creator ,</if>
        <if test="null!=updator  and ''!= updator">updator ,</if>
        )
        VALUES
        (
        NOW(),
        NOW()
        <if test="null!=order_no  and ''!= order_no">#{order_no} ,</if>
        <if test="null!=warehouse_id  and ''!= warehouse_id">#{warehouse_id} ,</if>
        <if test="null!=sale_order_id  and ''!= sale_order_id">#{sale_order_id} ,</if>
        <if test="null!=comb_id  and ''!= comb_id">#{comb_id} ,</if>
        <if test="null!=provider_logistics  and ''!= provider_logistics">#{provider_logistics} ,</if>
        <if test="null!=address  and ''!= address">#{address} ,</if>
        <if test="null!=to_time  and ''!= to_time">#{to_time} ,</if>
        <if test="null!=order_status  and ''!= order_status">
            (SELECT id FROM sys_config WHERE `key` = #{order_status}) ,
        </if>
        <if test="null!=remark  and ''!= remark">#{remark} ,</if>
        <if test="null!=creator  and ''!= creator">#{creator} ,</if>
        <if test="null!=updator  and ''!= updator">#{updator} ,</if>
        )
    </insert>

    <!-- 修改 -->
</mapper>
